# Excalidraw å¿«é€Ÿä¸Šæ‰‹æŒ‡å—

è¿™ä»½æŒ‡å—å°†å¸®åŠ©ä½ ä»é›¶å¼€å§‹å¿«é€Ÿä¸Šæ‰‹ Excalidrawï¼Œæ— è®ºæ˜¯ç›´æ¥ä½¿ç”¨è¿˜æ˜¯è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚

## 1. ç¯å¢ƒå‡†å¤‡

### 1.1 åŸºç¡€ç¯å¢ƒ

```bash
# Node.js ç‰ˆæœ¬è¦æ±‚
node --version  # éœ€è¦ 18.0.0 - 22.x.x

# æ¨èä½¿ç”¨ Yarnï¼ˆExcalidraw å®˜æ–¹ä½¿ç”¨ï¼‰
npm install -g yarn
yarn --version

# æˆ–è€…ä½¿ç”¨ npm
npm --version
```

### 1.2 è·å–æºç 

```bash
# æ–¹å¼ä¸€ï¼šç›´æ¥ä½¿ç”¨ï¼ˆæ¨èåˆå­¦è€…ï¼‰
npm install @excalidraw/excalidraw
# æˆ–
yarn add @excalidraw/excalidraw

# æ–¹å¼äºŒï¼šä¸‹è½½æºç ï¼ˆæ¨èæ·±åº¦å­¦ä¹ ï¼‰
git clone https://github.com/excalidraw/excalidraw.git
cd excalidraw
yarn install
```

## 2. æœ€ç®€å®ç°ï¼ˆ5åˆ†é’Ÿä¸Šæ‰‹ï¼‰

### 2.1 React é¡¹ç›®é›†æˆ

```typescript
// App.tsx
import React from "react";
import { Excalidraw } from "@excalidraw/excalidraw";
import "@excalidraw/excalidraw/index.css";

function App() {
  return (
    <div style={{ height: "100vh" }}>
      <Excalidraw />
    </div>
  );
}

export default App;
```

å°±æ˜¯è¿™ä¹ˆç®€å•ï¼è¿è¡Œé¡¹ç›®ä½ å°±èƒ½çœ‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ç”»æ¿åº”ç”¨ã€‚

### 2.2 çº¯ HTML é›†æˆ

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excalidraw Demo</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@excalidraw/excalidraw@latest/dist/prod/index.css">
</head>
<body>
    <div id="root" style="height: 100vh;"></div>
    
    <script type="module">
        import { Excalidraw } from "https://esm.sh/@excalidraw/excalidraw";
        
        const App = () => React.createElement(
            "div",
            { style: { height: "100vh" } },
            React.createElement(Excalidraw)
        );
        
        ReactDOM.render(React.createElement(App), document.getElementById("root"));
    </script>
</body>
</html>
```

## 3. åŸºç¡€åŠŸèƒ½é…ç½®ï¼ˆ15åˆ†é’ŸæŒæ¡ï¼‰

### 3.1 åŸºç¡€ Props é…ç½®

```typescript
import React, { useState } from "react";
import { Excalidraw } from "@excalidraw/excalidraw";
import type { ExcalidrawElement, AppState } from "@excalidraw/excalidraw/types";

function MyExcalidraw() {
  const [elements, setElements] = useState<ExcalidrawElement[]>([]);
  const [appState, setAppState] = useState<AppState | null>(null);

  return (
    <div style={{ height: "100vh" }}>
      <Excalidraw
        // åˆå§‹æ•°æ®
        initialData={{
          elements: [],
          appState: { 
            viewBackgroundColor: "#f0f0f0", // èƒŒæ™¯è‰²
            currentItemFontFamily: 1,       // é»˜è®¤å­—ä½“ (Virgil)
          },
        }}
        
        // ç›‘å¬å˜åŒ–
        onChange={(elements, appState) => {
          console.log("Elements changed:", elements);
          console.log("AppState changed:", appState);
          setElements(elements);
          setAppState(appState);
        }}
        
        // UI é…ç½®
        UIOptions={{
          canvasActions: {
            export: true,        // æ˜¾ç¤ºå¯¼å‡ºæŒ‰é’®
            loadScene: false,    // éšè—å¯¼å…¥åœºæ™¯
            saveAsImage: true,   // æ˜¾ç¤ºä¿å­˜å›¾ç‰‡
            theme: true,         // æ˜¾ç¤ºä¸»é¢˜åˆ‡æ¢
            clearCanvas: false,  // éšè—æ¸…ç©ºç”»å¸ƒ
          },
          tools: {
            image: true,         // å¯ç”¨å›¾ç‰‡å·¥å…·
          }
        }}
        
        // ä¸»é¢˜
        theme="light"
        
        // è¯­è¨€
        langCode="zh-CN"
        
        // æ¨¡å¼
        viewModeEnabled={false}  // å…³é—­åªè¯»æ¨¡å¼
        zenModeEnabled={false}   // å…³é—­ä¸“æ³¨æ¨¡å¼
        gridModeEnabled={false}  // å…³é—­ç½‘æ ¼æ¨¡å¼
        
        // è‡ªåŠ¨èšç„¦
        autoFocus={true}
      />
    </div>
  );
}
```

### 3.2 è‡ªå®šä¹‰å·¥å…·æ 

```typescript
import React from "react";
import { Excalidraw, MainMenu, WelcomeScreen } from "@excalidraw/excalidraw";

function CustomExcalidraw() {
  return (
    <div style={{ height: "100vh" }}>
      <Excalidraw
        // è‡ªå®šä¹‰é¡¶éƒ¨å³ä¾§UI
        renderTopRightUI={(isMobile, appState) => (
          <div style={{ display: "flex", gap: "8px" }}>
            <button
              onClick={() => {
                console.log("è‡ªå®šä¹‰æŒ‰é’®è¢«ç‚¹å‡»");
                // æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘
              }}
              style={{
                padding: "8px 16px",
                border: "1px solid #ccc",
                borderRadius: "4px",
                backgroundColor: "white",
              }}
            >
              è‡ªå®šä¹‰åŠŸèƒ½
            </button>
          </div>
        )}
        
        // è‡ªå®šä¹‰ç»Ÿè®¡ä¿¡æ¯
        renderCustomStats={(elements, appState) => (
          <div style={{ padding: "10px" }}>
            <div>å…ƒç´ æ•°é‡: {elements.length}</div>
            <div>ç¼©æ”¾çº§åˆ«: {Math.round(appState.zoom.value * 100)}%</div>
          </div>
        )}
      >
        {/* å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å­ç»„ä»¶ */}
        <WelcomeScreen>
          <WelcomeScreen.Hints.MenuHint />
          <WelcomeScreen.Hints.ToolbarHint />
        </WelcomeScreen>
        
        <MainMenu>
          <MainMenu.DefaultItems.SaveAsImage />
          <MainMenu.DefaultItems.Export />
          <MainMenu.Separator />
          {/* è‡ªå®šä¹‰èœå•é¡¹ */}
          <MainMenu.Item
            onSelect={() => console.log("è‡ªå®šä¹‰èœå•é¡¹ç‚¹å‡»")}
            shortcut="âŒ˜K"
          >
            è‡ªå®šä¹‰åŠŸèƒ½
          </MainMenu.Item>
        </MainMenu>
      </Excalidraw>
    </div>
  );
}
```

### 3.3 äº‹ä»¶å¤„ç†

```typescript
import React, { useRef } from "react";
import { Excalidraw, convertToExcalidrawElements } from "@excalidraw/excalidraw";
import type { ExcalidrawImperativeAPI } from "@excalidraw/excalidraw/types";

function EventHandlingExample() {
  const excalidrawRef = useRef<ExcalidrawImperativeAPI>(null);

  return (
    <div style={{ height: "100vh" }}>
      <Excalidraw
        ref={excalidrawRef}
        
        // æŒ‡é’ˆäº‹ä»¶
        onPointerUpdate={(payload) => {
          console.log("æŒ‡é’ˆä½ç½®:", payload.pointer);
        }}
        
        // ç²˜è´´äº‹ä»¶
        onPaste={(data, event) => {
          console.log("ç²˜è´´æ•°æ®:", data);
          
          // å¯ä»¥åœ¨è¿™é‡Œå¤„ç†è‡ªå®šä¹‰ç²˜è´´é€»è¾‘
          if (data.text === "è‡ªå®šä¹‰æ–‡æœ¬") {
            // åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ 
            const elements = convertToExcalidrawElements([
              {
                type: "text",
                x: 100,
                y: 100,
                text: "è¿™æ˜¯è‡ªå®šä¹‰ç²˜è´´çš„æ–‡æœ¬",
                fontSize: 20,
                fontFamily: 1,
                textAlign: "left",
                verticalAlign: "top",
              }
            ]);
            
            // æ›´æ–°åœºæ™¯
            excalidrawRef.current?.updateScene({ elements });
            
            return false; // é˜»æ­¢é»˜è®¤å¤„ç†
          }
          
          return true; // å…è®¸é»˜è®¤å¤„ç†
        }}
        
        // åº“å˜åŒ–äº‹ä»¶
        onLibraryChange={(libraryItems) => {
          console.log("åº“å·²æ›´æ–°:", libraryItems);
          // å¯ä»¥ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
          localStorage.setItem("excalidraw-library", JSON.stringify(libraryItems));
        }}
        
        // æ»šåŠ¨å˜åŒ–
        onScrollChange={(scrollX, scrollY) => {
          console.log("æ»šåŠ¨ä½ç½®:", scrollX, scrollY);
        }}
        
        // é“¾æ¥æ‰“å¼€
        onLinkOpen={(element, event) => {
          console.log("é“¾æ¥è¢«ç‚¹å‡»:", element.link);
          // å¯ä»¥è‡ªå®šä¹‰é“¾æ¥å¤„ç†é€»è¾‘
          event.preventDefault();
          window.open(element.link, "_blank");
        }}
      />
    </div>
  );
}
```

## 4. æ•°æ®æ“ä½œï¼ˆ30åˆ†é’Ÿå®æˆ˜ï¼‰

### 4.1 ä¿å­˜å’ŒåŠ è½½æ•°æ®

```typescript
import React, { useRef, useState } from "react";
import { Excalidraw, exportToBlob, serializeAsJSON } from "@excalidraw/excalidraw";
import type { ExcalidrawImperativeAPI, ExcalidrawElement } from "@excalidraw/excalidraw/types";

function DataManagementExample() {
  const excalidrawRef = useRef<ExcalidrawImperativeAPI>(null);
  const [savedData, setSavedData] = useState<string | null>(null);

  // ä¿å­˜ä¸ºJSON
  const saveAsJSON = () => {
    const elements = excalidrawRef.current?.getSceneElements();
    const appState = excalidrawRef.current?.getAppState();
    
    if (elements && appState) {
      const data = serializeAsJSON({
        elements,
        appState,
        files: excalidrawRef.current?.getFiles() || {},
      });
      
      setSavedData(data);
      
      // ä¿å­˜åˆ°æ–‡ä»¶
      const blob = new Blob([data], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "drawing.excalidraw";
      a.click();
      URL.revokeObjectURL(url);
    }
  };

  // åŠ è½½JSONæ•°æ®
  const loadFromJSON = () => {
    const input = document.createElement("input");
    input.type = "file";
    input.accept = ".excalidraw";
    
    input.onchange = (e) => {
      const file = (e.target as HTMLInputElement).files?.[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target?.result as string);
          
          excalidrawRef.current?.updateScene({
            elements: data.elements || [],
          });
          
          if (data.appState) {
            excalidrawRef.current?.updateScene({
              appState: data.appState,
            });
          }
          
        } catch (error) {
          console.error("åŠ è½½å¤±è´¥:", error);
        }
      };
      reader.readAsText(file);
    };
    
    input.click();
  };

  // å¯¼å‡ºä¸ºå›¾ç‰‡
  const exportAsImage = async () => {
    const elements = excalidrawRef.current?.getSceneElements();
    const appState = excalidrawRef.current?.getAppState();
    const files = excalidrawRef.current?.getFiles();

    if (elements && appState) {
      const blob = await exportToBlob({
        elements,
        appState,
        files,
        mimeType: "image/png",
        quality: 0.8,
      });

      // ä¸‹è½½å›¾ç‰‡
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "drawing.png";
      a.click();
      URL.revokeObjectURL(url);
    }
  };

  // æ¸…ç©ºç”»å¸ƒ
  const clearCanvas = () => {
    excalidrawRef.current?.updateScene({
      elements: [],
    });
  };

  return (
    <div style={{ height: "100vh" }}>
      {/* æ“ä½œæŒ‰é’® */}
      <div style={{ 
        position: "absolute", 
        top: 10, 
        left: 10, 
        zIndex: 10,
        display: "flex",
        gap: "8px",
      }}>
        <button onClick={saveAsJSON}>ä¿å­˜JSON</button>
        <button onClick={loadFromJSON}>åŠ è½½JSON</button>
        <button onClick={exportAsImage}>å¯¼å‡ºå›¾ç‰‡</button>
        <button onClick={clearCanvas}>æ¸…ç©ºç”»å¸ƒ</button>
      </div>

      <Excalidraw
        ref={excalidrawRef}
        onChange={(elements, appState) => {
          // è‡ªåŠ¨ä¿å­˜åˆ° localStorage
          const data = {
            elements,
            appState: {
              viewBackgroundColor: appState.viewBackgroundColor,
              zoom: appState.zoom,
              scrollX: appState.scrollX,
              scrollY: appState.scrollY,
            },
            timestamp: Date.now(),
          };
          localStorage.setItem("excalidraw-autosave", JSON.stringify(data));
        }}
        
        initialData={(() => {
          // ä» localStorage æ¢å¤æ•°æ®
          try {
            const saved = localStorage.getItem("excalidraw-autosave");
            if (saved) {
              const data = JSON.parse(saved);
              return {
                elements: data.elements || [],
                appState: data.appState || {},
              };
            }
          } catch (error) {
            console.error("æ¢å¤æ•°æ®å¤±è´¥:", error);
          }
          return { elements: [] };
        })()}
      />
    </div>
  );
}
```

### 4.2 ç¨‹åºåŒ–åˆ›å»ºå…ƒç´ 

```typescript
import React, { useRef } from "react";
import { Excalidraw, convertToExcalidrawElements } from "@excalidraw/excalidraw";
import type { ExcalidrawImperativeAPI } from "@excalidraw/excalidraw/types";

function ProgrammaticExample() {
  const excalidrawRef = useRef<ExcalidrawImperativeAPI>(null);

  // åˆ›å»ºåŸºç¡€å›¾å½¢
  const createBasicShapes = () => {
    const elements = convertToExcalidrawElements([
      // çŸ©å½¢
      {
        type: "rectangle",
        x: 100,
        y: 100,
        width: 200,
        height: 100,
        strokeColor: "#000000",
        backgroundColor: "#ff0000",
        fillStyle: "hachure",
        strokeWidth: 2,
        roughness: 1,
      },
      
      // åœ†å½¢
      {
        type: "ellipse",
        x: 400,
        y: 100,
        width: 150,
        height: 150,
        strokeColor: "#0000ff",
        backgroundColor: "transparent",
        strokeWidth: 3,
        roughness: 0.5,
      },
      
      // è±å½¢
      {
        type: "diamond",
        x: 100,
        y: 300,
        width: 120,
        height: 120,
        strokeColor: "#00ff00",
        backgroundColor: "#ffff00",
        fillStyle: "solid",
        strokeWidth: 1,
      },
      
      // æ–‡æœ¬
      {
        type: "text",
        x: 400,
        y: 350,
        text: "Hello Excalidraw!",
        fontSize: 20,
        fontFamily: 1, // Virgil
        textAlign: "center",
        verticalAlign: "top",
        strokeColor: "#000000",
      },
    ]);

    excalidrawRef.current?.updateScene({ elements });
  };

  // åˆ›å»ºç®­å¤´å’Œçº¿æ¡
  const createArrowsAndLines = () => {
    const elements = convertToExcalidrawElements([
      // ç®­å¤´
      {
        type: "arrow",
        x: 100,
        y: 500,
        points: [[0, 0], [200, 0]], // æ°´å¹³ç®­å¤´
        strokeColor: "#ff0000",
        strokeWidth: 3,
        startArrowhead: null,
        endArrowhead: "arrow",
      },
      
      // æŠ˜çº¿ç®­å¤´
      {
        type: "arrow", 
        x: 100,
        y: 600,
        points: [[0, 0], [100, 50], [200, -30]], // Lå½¢ç®­å¤´
        strokeColor: "#0000ff",
        strokeWidth: 2,
        startArrowhead: "dot",
        endArrowhead: "triangle",
      },
      
      // ç›´çº¿
      {
        type: "line",
        x: 400,
        y: 500,
        points: [[0, 0], [150, 100]],
        strokeColor: "#00ff00",
        strokeWidth: 1,
        strokeStyle: "dashed",
      },
    ]);

    excalidrawRef.current?.updateScene({ elements });
  };

  // åˆ›å»ºå¤æ‚å›¾å½¢
  const createComplexShape = () => {
    const elements = convertToExcalidrawElements([
      // æµç¨‹å›¾ç¤ºä¾‹
      {
        type: "rectangle",
        x: 200,
        y: 100,
        width: 120,
        height: 60,
        strokeColor: "#000000",
        backgroundColor: "#e3f2fd",
        fillStyle: "solid",
      },
      {
        type: "text",
        x: 260,
        y: 125,
        text: "å¼€å§‹",
        fontSize: 16,
        textAlign: "center",
        fontFamily: 2, // Helvetica
      },
      {
        type: "arrow",
        x: 260,
        y: 160,
        points: [[0, 0], [0, 40]],
        strokeColor: "#000000",
        endArrowhead: "arrow",
      },
      {
        type: "diamond",
        x: 200,
        y: 200,
        width: 120,
        height: 80,
        strokeColor: "#000000",
        backgroundColor: "#fff3e0",
        fillStyle: "solid",
      },
      {
        type: "text",
        x: 260,
        y: 235,
        text: "æ¡ä»¶åˆ¤æ–­",
        fontSize: 14,
        textAlign: "center",
        fontFamily: 2,
      },
    ]);

    excalidrawRef.current?.updateScene({ elements });
  };

  // æ‰¹é‡æ“ä½œå…ƒç´ 
  const batchOperations = () => {
    const currentElements = excalidrawRef.current?.getSceneElements() || [];
    
    // é€‰æ‹©æ‰€æœ‰çŸ©å½¢
    const rectangles = currentElements.filter(el => el.type === "rectangle");
    
    // æ‰¹é‡ä¿®æ”¹é¢œè‰²
    const updatedElements = currentElements.map(element => {
      if (element.type === "rectangle") {
        return {
          ...element,
          backgroundColor: "#f0f0f0",
          strokeColor: "#333333",
        };
      }
      return element;
    });

    excalidrawRef.current?.updateScene({ elements: updatedElements });
  };

  return (
    <div style={{ height: "100vh" }}>
      <div style={{ 
        position: "absolute", 
        top: 10, 
        left: 10, 
        zIndex: 10,
        display: "flex",
        gap: "8px",
        flexWrap: "wrap",
      }}>
        <button onClick={createBasicShapes}>åŸºç¡€å›¾å½¢</button>
        <button onClick={createArrowsAndLines}>ç®­å¤´çº¿æ¡</button>
        <button onClick={createComplexShape}>å¤æ‚å›¾å½¢</button>
        <button onClick={batchOperations}>æ‰¹é‡æ“ä½œ</button>
      </div>

      <Excalidraw ref={excalidrawRef} />
    </div>
  );
}
```

## 5. åä½œåŠŸèƒ½é›†æˆ

### 5.1 ç®€å•åä½œå®ç°

```typescript
import React, { useRef, useEffect, useState } from "react";
import { Excalidraw } from "@excalidraw/excalidraw";
import type { 
  ExcalidrawImperativeAPI, 
  ExcalidrawElement,
  Collaborator
} from "@excalidraw/excalidraw/types";

// æ¨¡æ‹Ÿçš„ WebSocket åä½œ
class SimpleCollaborationProvider {
  private ws: WebSocket | null = null;
  private callbacks: Set<(data: any) => void> = new Set();

  connect(url: string) {
    this.ws = new WebSocket(url);
    
    this.ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      this.callbacks.forEach(callback => callback(data));
    };
  }

  send(data: any) {
    if (this.ws?.readyState === WebSocket.OPEN) {
      this.ws.send(JSON.stringify(data));
    }
  }

  onMessage(callback: (data: any) => void) {
    this.callbacks.add(callback);
    return () => this.callbacks.delete(callback);
  }

  disconnect() {
    this.ws?.close();
  }
}

function CollaborationExample() {
  const excalidrawRef = useRef<ExcalidrawImperativeAPI>(null);
  const [collaborators, setCollaborators] = useState<Map<string, Collaborator>>(new Map());
  const collaboration = useRef(new SimpleCollaborationProvider());

  useEffect(() => {
    // è¿æ¥åä½œæœåŠ¡å™¨ï¼ˆè¿™é‡Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰
    // collaboration.current.connect("ws://localhost:8080");

    // ç›‘å¬åä½œæ¶ˆæ¯
    const unsubscribe = collaboration.current.onMessage((data) => {
      switch (data.type) {
        case "elements_update":
          excalidrawRef.current?.updateScene({
            elements: data.elements,
            commitToHistory: false, // ä¸è®°å½•åˆ°å†å²
          });
          break;
          
        case "collaborator_update":
          setCollaborators(prev => {
            const newCollaborators = new Map(prev);
            if (data.collaborator) {
              newCollaborators.set(data.userId, data.collaborator);
            } else {
              newCollaborators.delete(data.userId);
            }
            return newCollaborators;
          });
          break;
      }
    });

    return () => {
      unsubscribe();
      collaboration.current.disconnect();
    };
  }, []);

  // å‘é€å…ƒç´ æ›´æ–°
  const handleElementsChange = (elements: ExcalidrawElement[]) => {
    collaboration.current.send({
      type: "elements_update",
      elements: elements,
      timestamp: Date.now(),
    });
  };

  // å‘é€æŒ‡é’ˆä½ç½®
  const handlePointerUpdate = (payload: any) => {
    collaboration.current.send({
      type: "pointer_update",
      pointer: payload.pointer,
      button: payload.button,
      timestamp: Date.now(),
    });
  };

  return (
    <div style={{ height: "100vh" }}>
      <Excalidraw
        ref={excalidrawRef}
        
        // åä½œæ¨¡å¼
        isCollaborating={true}
        
        // åä½œè€…
        collaborators={collaborators}
        
        // å…ƒç´ å˜åŒ–å›è°ƒ
        onChange={(elements, appState) => {
          handleElementsChange(elements);
        }}
        
        // æŒ‡é’ˆæ›´æ–°å›è°ƒ
        onPointerUpdate={handlePointerUpdate}
        
        // ç”¨æˆ·åç”Ÿæˆ
        generateLinkForSelection={() => {
          return "https://your-app.com/drawing/123";
        }}
      />
      
      {/* åä½œè€…åˆ—è¡¨æ˜¾ç¤º */}
      {collaborators.size > 0 && (
        <div style={{
          position: "absolute",
          top: 10,
          right: 10,
          background: "white",
          padding: "10px",
          borderRadius: "4px",
          border: "1px solid #ccc",
          zIndex: 10,
        }}>
          <h4>åœ¨çº¿ç”¨æˆ· ({collaborators.size})</h4>
          {Array.from(collaborators.values()).map((collaborator, index) => (
            <div key={index} style={{ margin: "4px 0" }}>
              <span 
                style={{
                  display: "inline-block",
                  width: "12px",
                  height: "12px",
                  backgroundColor: collaborator.color?.background,
                  borderRadius: "50%",
                  marginRight: "8px",
                }}
              />
              {collaborator.username || `ç”¨æˆ· ${index + 1}`}
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
```

## 6. å¸¸è§é—®é¢˜è§£å†³

### 6.1 æ ·å¼å†²çª

```css
/* é¿å…å…¨å±€æ ·å¼å½±å“ Excalidraw */
.excalidraw-container {
  /* é‡ç½®å¯èƒ½å†²çªçš„æ ·å¼ */
  box-sizing: border-box;
  font-family: inherit;
  
  /* ç¡®ä¿å®¹å™¨å æ»¡å¯ç”¨ç©ºé—´ */
  width: 100%;
  height: 100%;
  
  /* é˜²æ­¢å¤–éƒ¨æ ·å¼å½±å“ */
  position: relative;
  overflow: hidden;
}

/* è‡ªå®šä¹‰ä¸»é¢˜æ ·å¼ */
.excalidraw .Island {
  background: #f8f9fa !important;
  border: 1px solid #e9ecef !important;
}

.excalidraw .ToolIcon_type_radio--checked {
  background: #007bff !important;
  color: white !important;
}
```

### 6.2 æ€§èƒ½ä¼˜åŒ–

```typescript
// å¤§é‡å…ƒç´ æ—¶çš„ä¼˜åŒ–é…ç½®
function PerformanceOptimizedExcalidraw() {
  const [elements, setElements] = useState<ExcalidrawElement[]>([]);
  
  // èŠ‚æµæ›´æ–°
  const throttledOnChange = useMemo(
    () => throttle((elements: ExcalidrawElement[], appState: AppState) => {
      setElements(elements);
      // åªä¿å­˜å¿…è¦çš„çŠ¶æ€
      const minimalAppState = {
        viewBackgroundColor: appState.viewBackgroundColor,
        zoom: appState.zoom,
        scrollX: appState.scrollX,
        scrollY: appState.scrollY,
      };
      localStorage.setItem("drawing-state", JSON.stringify({
        elements: elements.slice(0, 1000), // é™åˆ¶ä¿å­˜çš„å…ƒç´ æ•°é‡
        appState: minimalAppState,
      }));
    }, 1000),
    []
  );

  return (
    <Excalidraw
      onChange={throttledOnChange}
      
      // æ€§èƒ½ä¼˜åŒ–é€‰é¡¹
      initialData={{
        elements: [],
        scrollToContent: false, // ç¦ç”¨è‡ªåŠ¨æ»šåŠ¨åˆ°å†…å®¹
      }}
      
      // ç¦ç”¨ä¸€äº›æ¶ˆè€—æ€§èƒ½çš„åŠŸèƒ½
      renderScrollbars={false}
    />
  );
}
```

### 6.3 ç§»åŠ¨ç«¯é€‚é…

```typescript
function MobileOptimizedExcalidraw() {
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth <= 768);
    };
    
    checkMobile();
    window.addEventListener("resize", checkMobile);
    return () => window.removeEventListener("resize", checkMobile);
  }, []);

  return (
    <div style={{ 
      height: "100vh", 
      width: "100vw",
      position: "fixed",
      top: 0,
      left: 0,
    }}>
      <Excalidraw
        // ç§»åŠ¨ç«¯ä¼˜åŒ–é…ç½®
        UIOptions={{
          canvasActions: {
            export: !isMobile,        // ç§»åŠ¨ç«¯éšè—å¯¼å‡º
            loadScene: false,         // ç§»åŠ¨ç«¯éšè—è½½å…¥
            saveAsImage: !isMobile,   // ç§»åŠ¨ç«¯éšè—ä¿å­˜
            theme: true,              // ä¿ç•™ä¸»é¢˜åˆ‡æ¢
            clearCanvas: !isMobile,   // ç§»åŠ¨ç«¯éšè—æ¸…ç©º
          },
        }}
        
        // ç§»åŠ¨ç«¯ç¦ç”¨ä¸€äº›åŠŸèƒ½
        detectScroll={!isMobile}      // ç§»åŠ¨ç«¯ç¦ç”¨æ»šåŠ¨æ£€æµ‹
        handleKeyboardGlobally={!isMobile} // ç§»åŠ¨ç«¯å±€éƒ¨é”®ç›˜å¤„ç†
      />
    </div>
  );
}
```

## 7. ä¸‹ä¸€æ­¥å­¦ä¹ 

### 7.1 è¿›é˜¶ä¸»é¢˜

ç°åœ¨ä½ å·²ç»æŒæ¡äº† Excalidraw çš„åŸºç¡€ä½¿ç”¨ï¼Œå¯ä»¥ç»§ç»­å­¦ä¹ ï¼š

1. **[æ¶æ„è¯¦è§£](./01-æ¶æ„è¯¦è§£.md)** - æ·±å…¥ç†è§£ Excalidraw çš„è®¾è®¡åŸç†
2. **[å…ƒç´ ç³»ç»Ÿ](./02-å…ƒç´ ç³»ç»Ÿ.md)** - å­¦ä¹ å¦‚ä½•æ‰©å±•å’Œè‡ªå®šä¹‰å…ƒç´ 
3. **[æ¸²æŸ“å¼•æ“](./03-æ¸²æŸ“å¼•æ“.md)** - äº†è§£ç»˜å›¾å’Œæ€§èƒ½ä¼˜åŒ–åŸç†
4. **[å®æˆ˜æ¡ˆä¾‹](./12-å®æˆ˜æ¡ˆä¾‹.md)** - çœ‹çœ‹çœŸå®çš„åº”ç”¨åœºæ™¯

### 7.2 å¸¸ç”¨èµ„æº

```typescript
// å¸¸ç”¨å·¥å…·å‡½æ•°
import { 
  exportToCanvas,     // å¯¼å‡ºä¸º Canvas
  exportToSvg,        // å¯¼å‡ºä¸º SVG
  exportToBlob,       // å¯¼å‡ºä¸ºæ–‡ä»¶
  getSceneVersion,    // è·å–åœºæ™¯ç‰ˆæœ¬
  isInvisiblySmallElement, // æ£€æŸ¥å…ƒç´ æ˜¯å¦è¿‡å°
  getNonDeletedElements,   // è·å–æœªåˆ é™¤å…ƒç´ 
} from "@excalidraw/excalidraw";

// ç±»å‹å®šä¹‰
import type {
  ExcalidrawElement,      // å…ƒç´ ç±»å‹
  ExcalidrawTextElement,  // æ–‡æœ¬å…ƒç´ 
  ExcalidrawImageElement, // å›¾ç‰‡å…ƒç´ 
  AppState,               // åº”ç”¨çŠ¶æ€
  BinaryFiles,            // æ–‡ä»¶æ˜ å°„
  ExcalidrawImperativeAPI, // APIæ¥å£
} from "@excalidraw/excalidraw/types";
```

### 7.3 è°ƒè¯•æŠ€å·§

```typescript
// è°ƒè¯•æ¨¡å¼
if (process.env.NODE_ENV === "development") {
  // å¯ç”¨è°ƒè¯•ä¿¡æ¯
  window.EXCALIDRAW_DEBUG = true;
  
  // å¯¼å‡ºè°ƒè¯•å‡½æ•°åˆ°å…¨å±€
  window.getExcalidrawAPI = () => excalidrawRef.current;
  
  // æ·»åŠ è°ƒè¯•é¢æ¿
  const debugPanel = {
    getElements: () => excalidrawRef.current?.getSceneElements(),
    getAppState: () => excalidrawRef.current?.getAppState(),
    getFiles: () => excalidrawRef.current?.getFiles(),
    clearScene: () => excalidrawRef.current?.updateScene({ elements: [] }),
  };
  
  window.excalidrawDebug = debugPanel;
}

// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­å¯ä»¥ä½¿ç”¨ï¼š
// window.excalidrawDebug.getElements() æŸ¥çœ‹æ‰€æœ‰å…ƒç´ 
// window.excalidrawDebug.clearScene() æ¸…ç©ºç”»å¸ƒ
```

æ­å–œï¼ä½ ç°åœ¨å·²ç»æŒæ¡äº† Excalidraw çš„åŸºç¡€ä½¿ç”¨å’Œè¿›é˜¶æŠ€å·§ã€‚å¿«å»åˆ›å»ºä½ çš„ç”»æ¿åº”ç”¨å§ï¼ğŸ¨